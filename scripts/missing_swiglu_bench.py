import torch
from triton_swiglu import fused_silu_and_mul

tuples = [('448', '512'), ('3072', '64'), ('44', '128'), ('2688', '256'), ('928', '32'), ('88', '16'), 
          ('144', '128'), ('928', '256'), ('192', '512'), ('44', '256'), ('448', '8192'), ('1728', '8192'), ('1856', '256'), ('88', '4096'), ('864', '128'), ('400', '4096'), ('132', '64'), ('176', '2048'),
           ('44', '32'), ('3072', '256'), ('192', '4096'), ('176', '64'), ('2688', '4096'), 
           ('3072', '512'), ('144', '4096'), ('928', '64'), ('132', '128'), ('176', '4096'), ('896', '2048'), 
           ('864', '64'), ('192', '2048'), ('352', '64'), ('448', '16'), ('3072', '128'), ('132', '32'),
             ('88', '1024'), ('400', '512'), ('352', '256'), ('400', '16'), ('88', '512'), ('896', '8192'), 
             ('864', '256'), ('1856', '4096'), ('264', '64'), ('132', '8192'), ('928', '128'), ('176', '16'), ('448', '32'), 
             ('2304', '64'), ('928', '1024'), ('44', '2048'), ('44', '64'), ('1856', '64'), ('1728', '128'),
               ('3072', '1024'), ('4096', '2048'), ('1856', '128'), ('4096', '16'), ('44', '16'), ('132', '256'), 
               ('2304', '8192'), ('3072', '4096'), ('8192', '64'), ('2688', '16'), ('352', '4096'), ('8192', '1024'), 
               ('4096', '8192'), ('132', '512'), ('144', '1024'), ('1728', '512'), ('2688', '8192'), ('896', '256'),
                 ('1856', '32'), ('4096', '4096'), ('8192', '512'), ('400', '64'), ('144', '256'), ('176', '256'),
                   ('176', '1024'), ('2688', '1024'), ('8192', '4096'), ('2304', '32'), ('928', '512'), ('448', '1024'), 
                   ('1856', '16'), ('4096', '512'), ('4096', '32'), ('88', '128'), ('192', '32'), ('1728', '32'), ('264', '16'),
                     ('176', '8192'), ('400', '256'), 
                   ('2304', '1024'), ('400', '32'), ('400', '2048'), ('2688', '64'), ('144', '8192'), ('2688', '128'),
                     ('1856', '1024'), ('400', '128'), ('448', '64'), ('864', '2048'), ('8192', '32'), ('1728', '1024'), ('88', '256'), ('1856', '2048'), ('352', '2048'), ('44', '512'), ('144', '2048'), ('352', '1024'), ('4096', '256'), ('896', '512'), ('192', '256'), ('352', '512'), ('1728', '4096'), ('4096', '64'), ('448', '256'), ('132', '1024'), ('88', '32'), ('2304', '512'), ('864', '16'), ('192', '64'), ('44', '1024'), ('2304', '128'), ('3072', '32'), ('44', '8192'), ('3072', '2048'), ('264', '32'), ('352', '8192'), ('4096', '128'), ('44', '4096'), ('176', '512'), ('88', '8192'), ('448', '2048'), ('132', '4096'), ('400', '1024'), ('352', '128'), ('4096', '1024'), ('192', '1024'), ('8192', '16'), ('896', '4096'), ('8192', '2048'), ('1856', '8192'), ('8192', '256'), ('132', '2048'), ('448', '4096'), ('176', '128'), ('88', '2048'), ('864', '512'), ('192', '16'), ('2304', '16'), ('8192', '128'), ('2688', '32'), ('352', '16'), ('928', '2048'), ('88', '64'), ('864', '1024'), ('352', '32'), ('3072', '16'), ('1728', '2048'), ('132', '16'), ('864', '8192'), ('192', '8192'), ('896', '1024'), ('928', '16'), ('864', '32'), ('864', '4096'), ('8192', '8192'), ('144', '64'), ('1856', '512'), ('144', '512'), ('2688', '2048'), ('1728', '16'), ('2304', '4096'), ('2304', '2048'), ('1728', '256'), ('1728', '64'), ('3072', '8192'), ('400', '8192'), ('2304', '256'), ('192', '128'), ('2688', '512'), ('448', '128'), ('176', '32')]

for tuple in tuples:
    try:
        x = torch.randn(int(tuple[1]), 2 * int(tuple[0]), dtype=torch.float16, device='cuda').uniform_(-1 * 0.1, 0.1)
    except RuntimeError as e:
        print(f"Could not collect {tuple} because of {e}")
        continue
    fused_silu_and_mul(x)

# tokens = [2**i for i in range(4,14)]
# heads = [2**i for i in range(4, 14)]

# for token in tokens:
#     for d in heads:
#         input = torch.randn(token, 2 * d, device="cuda", dtype=torch.float16)
#         fused_silu_and_mul(input)
